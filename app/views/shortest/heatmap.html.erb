<style>
html, body, #map {
	height: 100%;
	width: 100%;
}

</style>
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
<script src='//api.tiles.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.2.0/leaflet-omnivore.min.js'></script>
<script src='http://code.jquery.com/jquery-2.1.3.min.js'></script>
<script src="<%= root_path %>js/leaflet-heat.js"></script>
<script src="<%= root_path %>js/heatmap.min.js"></script>
<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
<script>
	start_lat = -33.5845709
	start_lon = -70.5651589
	end_lat   = -33.5845709
	end_lon   = -70.5651589
	base_url = '<%= root_url %>'
	function getData() {
		 src = base_url + 'shortest/getAlertsHeatMap'
		 // src = base_url + 'shortest/getShortestRouteStatic'
		 $.ajax({
		 	url: src,
		 }).done(function(data) {
			LoadMap(data)
		 }).error(function(xhr, status, error){
		 	alert(xhr.responseText)
		 	console.log(xhr.responseText)
		 })

	}
	function LoadMap(data) {
		var testData = {
		  max: 8,
		  data: data
		};

		var baseLayer = L.tileLayer(
		  'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
		    attribution: '...',
		    maxZoom: 18
		  }
		);

		var cfg = {
		  // radius should be small ONLY if scaleRadius is true (or small radius is intended)
		  // if scaleRadius is false it will be the constant radius used in pixels
		  "radius": 10,
		  "maxOpacity": .8,
		  // scales the radius based on map zoom
		  "scaleRadius": false,
		  // if set to false the heatmap uses the global maximum for colorization
		  // if activated: uses the data maximum within the current map boundaries
		  //   (there will always be a red spot with useLocalExtremas true)
		  "useLocalExtrema": true,
		  // which field name in your data represents the latitude - default "lat"
		  latField: 'lat',
		  // which field name in your data represents the longitude - default "lng"
		  lngField: 'lng',
		  // which field name in your data represents the data value - default "value"
		  valueField: 'count'
		};


		var heatmapLayer = new HeatmapOverlay(cfg);

		min_lat = data[0]['lat']
		max_lat = data[0]['lat']
		min_lon = data[0]['lng']
		max_lon = data[0]['lng']

		for (var i = 0; i < data.length; i++) {
			if( data[i]['lat'] < min_lat) {
				min_lat = data[i]['lat']
			}
			if( max_lat < data[i]['lat']) {
				max_lat = data[i]['lat']
			}
			if( data[i]['lng'] < min_lon) {
				min_lon = data[i]['lng']
			}
			if( max_lon < data[i]['lng']) {
				max_lon = data[i]['lng']
			}
		};

		lat_center = (max_lat + min_lat) / 2
		lon_center = (max_lon + min_lon) / 2
		var map = new L.Map('map', {
		  center: new L.LatLng(lat_center, lon_center),
		  zoom: 12,
		  layers: [baseLayer, heatmapLayer]
		});

		heatmapLayer.setData(testData);
	}
	if (window.addEventListener) // W3C standard
	{
	  window.addEventListener('load', getData, false); // NB **not** 'onload'
	}
	else if (window.attachEvent) // Microsoft
	{
	  window.attachEvent('onload', getData);
	}

</script>
<div id="map">
	<div class="progress">
      <div class="indeterminate"></div>
  	</div>
	<div class="fixed-action-btn" style="bottom: 45px; right: 24px;">
		<a class="btn-floating btn-large green">
			<i class="large mdi-image-flash-on"></i>
		</a>
		<ul>
			<li>
				<a class="btn-floating red" style="transform: scaleY(0.4) scaleX(0.4) translateY(40px); opacity: 0;">
					<i class="large mdi-alert-warning"></i>
				</a>
			</li>

			<li>
				<a class="btn-floating yellow darken-1" style="transform: scaleY(0.4) scaleX(0.4) translateY(40px); opacity: 0;">
					<i class="large mdi-alert-warning"></i>
				</a>
			</li>

			<li>
				<a class="btn-floating green" style="transform: scaleY(0.4) scaleX(0.4) translateY(40px); opacity: 0;">
					<i class="large mdi-image-flash-on"></i>
				</a>
			</li>

			<li>
				<a class="btn-floating blue" style="transform: scaleY(0.4) scaleX(0.4) translateY(40px); opacity: 0;">
					<i class="large mdi-action-verified-user"></i>
				</a>
			</li>
		</ul>
    </div>
</div>
